language: sh
sudo: false

env:
  - SCRIPTS='generate-script generate-readme pomfload'

addons:
  apt:
    packages:
      - g++
      - gcc
      - libc6-dev
      - libffi-dev
      - libgmp-dev
      - make
      - xz-utils
      - zlib1g-dev
      - git
      - gnupg

      - devscripts
      - jq

install:
  - mkdir -p "$HOME/.local/bin"
  - export PATH="$HOME/.local/bin:$PATH"

  - mkdir stack_tmp
  - wget https://www.stackage.org/stack/linux-x86_64 -O stack.tar.gz
  - tar xzf stack.tar.gz -C stack_tmp
  - cp stack_tmp/*/stack "$HOME/.local/bin/"
  - which stack
  - stack --version

  - git clone --depth=10 https://github.com/koalaman/shellcheck.git
  - cd shellcheck
  - stack update
  - stack setup
  - stack install
  - cd ..
  - which shellcheck
  - shellcheck --version

script:
  - checkbashisms -xp ${SCRIPTS}
  - shellcheck --shell=sh ${SCRIPTS}
  - jq . sites.json
  - jq -r "$(cat sites_to_help_text.jq)" sites.json
  - diff <(./generate-script) pomfload
  - diff <(./generate-readme) README.rst
